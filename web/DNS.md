# DNS와 레코드 설정

**updated 2023.05.15**

목차

1. DNS란 ?
2. DNS 레코드 설정이란?
3. 레코드 종류와 각 설정의 의미
4. 결론

## DNS란?

도메인 이름 시스템(DNS)은 사람이 읽을 수 있는 도메인 이름(예: www.amazon.com)을 머신이 읽을 수 있는 IP 주소(예: 192.0.2.44)로 변환합니다.

<img src="https://d1.awsstatic.com/Route53/how-route-53-routes-traffic.8d313c7da075c3c7303aaef32e89b5d0b7885e7c.png" />

## DNS 레코드 설정이란?

DNS 레코드란 - 호스트 이름 또는 도메인에 대한 중요한 정보를 제공하는 레코드입니다. 이러한 레코드에는 도메인의 현재 IP 주소가 포함됩니다. 또한 DNS 레코드는 신뢰할 수 있는 DNS 서버의 텍스트 파일(영역 파일)에 저장됩니다. DNS 레코드 파일의 내용은 DNS 서버가 이해하는 특수 명령이 포함된 문자열입니다.

이러한 DNS 레코드 설정을 통해, DNS의 작동을 컨트롤 할 수 있습니다.

DNS 레코드 종류 표
<img src="https://upload.wikimedia.org/wikipedia/commons/5/59/All_active_dns_record_types.png"/>

## 레코드 종류와 각 설정의 의미

주요한 5가지 DNS 레코드 유형

- A 레코드
- AAAA 레코드
- CNAME 레코드
- 네임서버(NS) 레코드
- 메일 교환(MX) 레코드

### 1. A레코드

A 레코드는 가장 중요한 DNS 레코드 유형입니다. A 레코드의 "A"는 "Address"를 나타냅니다. A 레코드는 특정 호스트 이름 또는 도메인의 IP 주소를 보여줍니다.

- A 레코드는 IPV4 주소만 지원합니다.
- 주요 용도는 IP주소 조회 입니다. A레코드를 사용하여 IP를 몰라도 도메인 이름으로도 웹사이트를 로드할 수 있습니다.
- 또 다른 용도는 DNSBL(도메인 이름 시스템 기반 블랙홀 목록)입니다. A레코드는 알려진 스팸소스의 메일을 차단하는데 사용됩니다.

### 2. AAAA 레코드

AAAA 레코드는 A 레코드와 마찬가지로 도메인의 IP 주소를 가리킵니다. 그러나 이 DNS 레코드 유형은 IPV6 주소를 가리킨다는 점에서 다릅니다.

- AAAA 레코드는 도메인 이름을 최신 IPV6 프로토콜 주소로 확인하는 데 사용됩니다.
  - DNS 확인을 위한 AAAA 레코드의 사용은 IPV4보다 개선된 IPV6을 사용하기 때문에 큰 잠재력을 가지고 있습니다.
  - 또한 인터넷이 계속 성장하고 IPV4 주소가 고갈됨에 따라 AAAA 레코드의 가능성이 높습니다.

### 3. CNAME 레코드

CNAME(canonical name / 표준이름)은 도메인 이름(별칭)이 다른 도메인을 가르키는 DNS 레코드 입니다.
CNAME 레코드에서 별칭은 IP주소를 가리키지 않습니다. 별칭이 가리키는 도메인 이름이 정식 이름입니다.

예를들어, ng.example.com 이 도메인을 CNAME을 설정하여 example.com을 가리킬 수 있습니다.
example.com은 A레코드를 사용하여 실제 IP 주소를 가리킵니다.

- 동일한 서버에서 다양한 목적으로 여러 하위 도메인을 실행할 때 쓰입니다.
- 예를들어 파일전송 프로토콜 사용시 ftp.example.com을 사용하고, www.example.com을 통해 웹페이지를 제공한다고 할 때, CNAME 레코드를 사용하여 하위 도메인 모두 example.com을 가리키도록 할 수 있습니다.
- CNAME이 다른 CNAME을 가리키는 것도 가능합니다만, 비효율적이며 로드속도가 느려져 사용자 경험이 저하될 수 있습니다.

### 4. NS 레코드

NS(네임서버)레코드는 도메인에 대한 신뢰할 수 있는 DNS 서버를 지정합니다.
즉, NS 레코드는 웹브라우저와 같은 인터넷 앱이 도메인 으로 IP주소를 찾는데 도움이 됩니다.
일반적으로 도메인에 대해 여러 네임서버가 지정됩니다. (ex. ns1.exampleHostingProvider.com 및 ns2.exampleHostingProvider.com )

- 웹 호스팅 서비스 구입시 간단한 웹사이트 설정시 네임서버 세부정보가 포함된 이메일을 받았을 것입니다.
  이러한 네임서버는 도메인 이름을 사이트가 호스팅되는 실제 서버에 연결합니다.
  네임서버에는 A 레코드 및 MX 레코드와 같은 도메인에 대한 다른 DNS 레코드가 포함되어 있습니다.

### 5. MX 레코드

메일 교환(MX) 레코드는 도메인의 이메일이 라우팅되어야 하는 위치를 보여주는 DNS 레코드 유형입니다. 즉, MX 레코드를 사용하면 이메일을 메일 서버로 보낼 수 있습니다.

- MX 레코드를 사용하면 이메일을 전용 이메일 서버로 전달할 수 있습니다.
  예를 들어, 소유하고 있는 서버에서 웹메일을 설정하는 모든 문제를 전문 이메일 제공업체에 맡기기로 결정할 수 있습니다. 이것은 이메일을 읽고 보내기 위한 사용자 지정 이메일 클라이언트, 향상된 보안 및 스팸 필터를 포함하여 많은 이점을 제공합니다

단일 도메인 이름에 대해 여러 MX 레코드를 가질 수 있습니다. 이것이 의미하는 바는 백업 이메일 서버를 가질 수 있다는 것입니다. 다음은 여러 MX 레코드가 있는 도메인의 예를 보여줍니다.

## 결론

DNS 설정은 곧 레코드 설정.
각 레코드가 무엇을 의미하는지 잘 알고 쓰자.

### 접속 오류 이야기.

현 회사에서, 외주로 뉴스룸 홈페이지를 운영 관리해주고 있었다.
서버를 SK 클라우드 -> GCP로 옮기는 과정에서,

- 도메인 소유권은 뉴스룸 회사에서 소유,관리를 전제로 했기 때문에
- NS (네임서버) 변경을 Google-Cloud DNS로 요청한 상태였다.
  그런데 NS서버 변경이 되었다는 연락 후, 해당 뉴스룸 웹페이지에 접속이 안된다는 연락이 왔었다.

처음 추측한 원인은,
NS서버 변경후, 기존 NS서버의 A레코드 삭제로 인해, 기기에 해당 웹페이지(NS)가 캐싱된 경우, 경로를 찾지 못함 이였다.
대응 조치로는 삭제된 A레코드 복구 및 기기에 캐싱기록 삭제, 시간이 흘러감에 안정화(보통 1~2일 이내) 가 있었다.

그런데 며칠 뒤 해당 업체 개발자로부터, DNS 설정을 하는데, 요구한 CNAME으로 4개의 도메인 등록이 불가하다는 연락이 왔다.
아마도 그 개발자는 CNAME 레코드 설정과 NS 레코드 설정을 혼돈한듯 했다.
기존 CNAME 설정시 연결할 표준 도메인 주소를 작성해 줘야하는데, 생뚱 맞은 NS 주소를 입력했으니, 경로를 찾지 못했을 것이다.

의문은 장애후 30분 후에는 정상적으로 접속이 되었는데,
해당 업체 개발자가 CNAME을 복구 한 것일까? 아니면 변경된 NS의 A레코드가 참조된 것일까?
이부분은 더 확인을 해보아야 할 것 같다.

## 참고

- [DNS 레코드 유형: 정의 및 설명](https://www.site24x7.com/learn/dns-record-types.html)
- [List of DNS record types](https://en.wikipedia.org/wiki/List_of_DNS_record_types)
- [윈도우 서버 - 영역 데이터(레코드) 구성](https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=sol9501&logNo=70103837255)
